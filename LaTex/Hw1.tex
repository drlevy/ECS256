\documentclass[10pt,a4paper]{article}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage[width=14.00cm, height=25.00cm]{geometry}
\begin{document}
\section{Part 1}
\subsection*{Markov Chain}
We have two states :{Old box, New box}. \\
The system is in ``New box'' when we have exactly one item in the current box that is being filled. The system is in ``Old box'' when the current box contains more than one item.\\
$ X $ is the random variable for the weight of the current box.\\
$ W $ is the random variable for the weight of incoming item.\\

\subsection*{Transition matrix}
The transition probabilities are as follows:\\
$ P_{NN} $ is the probability of going from state ``New box'' to state ``New box''. This happens when the weight of the new box (that has a single item) plus the incoming item exceeds the maximum allowed. Hence, we have a transition from one new box to another new box.\\
$ P_{ON} $ is the probability of going from state ``Old box'' to state ``New box''. This happens when the weight of the current box plus the new item exceeds the maximum weight. Hence, we have a transition to a new box to accommodate the newest item.\\
$ P_{NO} $ is the probability of going from state ``New box'' to state ``Old box''. This happens when the new box is able to accept the newest item and thereby becoming an ``Old box''.\\
$ P_{OO} $ is the probability of going from state ``Old box'' to state ``Old box''. This happens when our current box (with 2 or more items) can accommodate the newest item while maintaining maximum weight. Therefore, there is not a need for a new box. \\

Mathematically, by conditioning on the item at time $ n $ we have:\\
\begin{align*}
P_{NN} &= P_{ON} &= P(X > w_{max} -W) &= \sum\limits_{k=1}^{w_{max}} P(X > w_{max} -W | W=k)\cdot P(W=k)  \\
P_{OO} &= P_{NO} &= P(X \leq w_{max} -W) &=\sum\limits_{k=1}^{w_{max}} P(X \leq w_{max} -W | W=k)\cdot P(W=k) \\
\end{align*}
Now, $ P(X \leq w_{max} -W | W=k) $ is the probability that the weight of the current box is less than or equal to $ w_{max} - k $. \\
\begin{align*}
P(X \leq w_{max} - W| W=k) &= P(X \leq w_{max} -k)\\
&= \sum_{i \leq w_{max}-k} P(X = i) \\
&= \sum_{i \leq w_{max} - k} \pi_i \\
\end{align*}
Where $\pi_i$ the stationary probability that the current box weighs $w_i$ (calculated in Part 2). \\
In other words, the probability that the current box weighs more than $ w_{max} - k $ is the long run probability that box weighs $1$ plus the long run probability that the box weighs $2$, and so on up to $ w_{max} - k $. \\

Similarly, we have \\
\begin{align*}
P(X > w_{max} -W | W=k) &= \sum_{i > w_{max}-k} P(X = i)\\ 
&= \sum_{i > w_{max} -k} \pi_i \\
\end{align*}

Putting everything together, \\
\begin{align*}
P_{NN} &= P_{ON} = \sum\limits_{k=1}^{w_{max}} \left(\sum_{i \leq w_{max} -k} \pi_i \right) \cdot P(W=k)  \\
P_{NO} &= P_{OO} = \sum\limits_{k=1}^{w_{max}} \left(\sum_{i > w_{max} -k} \pi_i \right) \cdot P(W=k) \\
\end{align*}


\subsection*{Solution}
Finally, the long run average number of items in any box is the average time for a system in state N to return to state N. This is $ E(T_{NN}) $, where T is the random variable for hitting times. \\
To find $ E(T_{NN}) $, we follow the similar argument in the book. \\
First, we condition on the first stop $ U $. 
\begin{align*}
E(T_{NN}) = P_{NO}\cdot E(T_{NN}|U=O)+P_{N,N}\cdot E(T_{NN}|U=N)
\end{align*}
where,\\
\begin{align*}
E(T_{NN}|U=N) &= 1 \\
E(T_{NN}|U=O) &= 1+E(T_{ON})
\end{align*}
Simplifying the above, we arrive at\\
\begin{align*}
E(T_{NN}) = 1+ P_{NO}\cdot E(T_{ON})
\end{align*}
By repeating the same argument for $ E(T_{ON} $, we find \\
\begin{align*}
E(T_{ON}) = 1+ P_{OO}\cdot E(T_{ON})
\end{align*}
Hence, 
\begin{align*}
E(T_{ON}) = \frac{1}{1 - P_{OO}}
\end{align*}
Putting this back in our previous expression of $ E(T_{NN}) $
\begin{align*}
E(T_{NN}) = 1+ \frac{P_{NO}}{1 - P_{OO}}
\end{align*}


\section{Part 2}



\section{Part 3}
Looking at the system differently, we can model using a different Markov chain:\\
The states are $ S_1, S_2, S_3, ..., S_m$, where $m$ is $w_{max}$ and $S_i$ represents the state where $w_i$ is the first item in the current box.\\

The transition probability $P_{ij}$ of going from a state $i$ to a state $j\neq i$ is equalled to the probability of needing a new box while in state $i$ (first item is $w_i$) to store a new item weighing $w_j$ (the first item of the new box - state $j$). This probability is:\\
\begin{align*}
P_{ij}= P(X_n + w_k > w_{max}) \cdot P( W_n = w_k)= \sum_{i > w_{max} -k} \pi_i \cdot P( W_n = w_k)
\end{align*}
To find $P_{ii}$, we need to consider two independent cases when state $i$ loops back on itself. First, the system remains in a state $i$ if the next item does not cause it to exceed the maximum weight. This probability is:\\
\begin{align*}
P(X_n + W_i \leq w_{max}) &= P_{NN} \\
&= \sum\limits_{k=1}^{w_{max}} P(X_n > w_{max} -W_n | W_n=k)\cdot P(W_n=k) \\
&= \sum\limits_{k=1}^{w_{max}} \left( \sum_{i > w_{max} -k} \pi_i \right) \cdot P(W_n=k)
\end{align*}
In the second case, the system remains in state $i$ if a '$w_i$ item' arrives which would push the current weight over the limit. This probability is:\\
\begin{align*}
P( X_n + w_i > w_{max}) \cdot P( W_n = w_i) =\sum_{i > w_{max} -w_i} \pi_i \cdot P( W_n = w_i)
\end{align*}

Knowing the transition matrix, we can now solve the eigenvalue equation to get the stationary probabilities. $\pi_i$ in this case gives the percentage of time the system spends in state $i$ - that is the percentage of time that the -uh oh guys, as I'm typing this I think this is wrong!!!!!!!!!!!!!!




\end{document}


